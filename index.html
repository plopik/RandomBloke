<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mini Random Tennis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/optimization-js@latest/dist/optimization.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.min.css">
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="simulation.js"></script>
    <script src="manual.js"></script>
    <script src="automation.js"></script>
    <script src="optimizer.js"></script>

    <style>
        body {
            margin: 0;
            font-family: sans-serif;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            flex: 0 0 200px;
            background: #f4f4f4;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            padding: 24px 12px;
        }

            .sidebar button {
                margin: 8px 16px;
                padding: 12px;
                font-size: 1em;
                border: none;
                background: #e0e0e0;
                border-radius: 4px;
                cursor: pointer;
                transition: background 0.2s;
            }

                .sidebar button.active {
                    background: #1a73e8;
                    color: #fff;
                }

        .main {
            flex: 1;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 40px;
            background: #fafbfc;
        }

        .panel {
            display: none;
            width: 100%;
        }

            .panel.active {
                display: flex;
                flex-flow: row wrap;
                justify-content: space-evenly;
                align-items: self-start;
                border: dashed 1px #ccc;
            }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <button id="btn0" style="border:1px solid black; padding: 5px;">
                <h2 >Mini Random Tennis</h2>
            </button>
            <button id="btn1">Tutorial</button>
            <button id="btn2">Automating</button>
            <button id="btn3">Charting</button>
            <button id="btn4">Optimizing</button>
</div>
        <div class="main">
            <div id="panel0" class="panel active">
                <div style="">
                    <h2>What's the deal with this whole <b>Game, Set and Match</b> thing in Tennis ?</h2>
                    I mean if I want to know who is the best at hitting balls why not just tally the total number of point.<br>
                    Research and LLMs give some mildly convincing answers, like :
                    <ul>
                        <li>Dividing the match into games and sets gives players chances to reset and regroup</li>
                        <li>A player can lose a few points but still win the match</li>
                        <li>Sets allow for comebacks, which add drama</li>
                    </ul>
                    But honestly, other sports that don’t use sets still have comebacks, drama, and breaks for rest and strategy.

                    <p>So what really makes the usage of Sets different?</p>
                    <p>One thing stands out: Sets seem to make some points more impactful than others.</p>
                    <p>But it made me wonder... Is that even true? And if so how much?</p>
                    <p>So I made this ! (WIP)</p>
                </div>
            </div>
            <div id="panel1" class="panel">
                <div style="flex : 1 0 300px;">
                    <h2>A Simple Yet Tedious Game</h2>

                    <ul>
                        <li>Each player has an energy pool used to make moves.</li>
                        <li>In each round, the player chooses how much energy to use.</li>
                        <li>After each round, both players recover 1 energy.</li>
                        <li>In each round, one of the players is randomly awarded a point.</li>
                        <li>The first player to reach 3 points wins the set.</li>
                    </ul>

                    <p>How the winner of a point is determined:</p>

                    <ul>
                        <li>Let <b>E</b> = energy used by the player.</li>
                        <li>The dummy always uses 1 energy.</li>
                        <li>A random number <b>R</b> is chosen between 0 and (E + 1).</li>
                        <li>If <b>R</b> &lt; <b>E</b>, the player wins the point.</li>
                        <li>Otherwise, the dummy wins the point.</li>
                    </ul>

                    <p>This means the probability that the player wins the point is <b>E / (E + 1)</b>.</p>
                    <ul>
                        <li>You play against a dummy opponent.</li>
                        <li>The dummy always uses 1 energy per round.</li>
                        <li>The game doesn't "end" — it's just a toy game for trying out different strategies </li>
                    </ul>
                    <p>
                        Feel free to keep playing — but fair warning: even with optimal strategy, your edge over the dummy is so small that playing manually feels more like a test of patience than skill.
                        You might want to head over to the next tab sonner rather than later.
                    </p>

                </div>
                <div style="flex: 0 0 380px">
                    <h2>Try it!</h2>
                    <button id="simStepBtn">Play a round</button>
                    <button id="simResetBtn">Reset</button>
                    <br><br>
                    <div id="interactiveSimArea" style="min-height:220px;"></div>
                </div>
            </div>
            <div id="panel2" class="panel">
                <div style="flex : 1 0 400px; display: flex; flex-flow: column; max-height:300px">
                    <h2>Let a bot do the work</h2>
                    <p>Tell the bot what to do and see if you can find a good strategy off the top of your head</p>
                    <textarea id="strategyBox" rows="6" cols="40">
//Example strategy for the bot, you can do better!
function strategy(botID, energy, botPoint, dummyPoint) {
    return (botPoint > dummyPoint) ? 1+energy/100 : 0.99
}</textarea>
                    <button id="applyStrategy">Apply</button>
                    <button id="pauseBtn">Pause</button>
                </div>
                <div style="flex 0 0 400px">
                    <h2>Can you consistently beat the dummy?</h2>
                    <div id="autoSimArea" style="min-height:220px;"></div>
                </div>
            </div>
            <div id="panel3" class="panel" style="align-items:self-start">
                <div style="flex : 0 0 400px; display: flex; flex-flow: column; width: 300px">
                    <h2>Let's tinker!</h2>
                    <p>Use the botID to simultaneously evaluate a lot of different strategies at once.</p>
                    <p>Get a feel for what could be the best strategy.</p>
                </div>
                <div style="flex : 1 0 400px; display: flex; flex-flow: column; max-height:250px">
                    <textarea id="strategyFunc" rows="5" cols="40">
//Example strategy for the bots, you can do better!
let m = Array(100);
for (let i = 0; i < 100; i++) {
    const e = i*0.1;
    m[i] = e;
};
function strategy(botID, energy, botPoint, dummyPoint) {
    let test = botPoint+dummyPoint > 3;
    let value = (test) ? 1+m[botID] : 1;
    let normalized = value * energy / 1000;
    return normalized;
}</textarea>
                    <br>
                    <button id="chartApply">Apply</button>
                    <button id="chartPause">Pause</button>
                </div>
                <div id="chartPanel" style="flex: 1 1 80%; background:#fff; max-height: 500px">
                    <div id="bestSetWinRatio" style="font-size:1.5em; font-weight:bold; color:#1a73e8; margin-bottom:16px;">
                        Best Set Win Ratio: 0%
                    </div>
                    <div id="ticksPerSecond" style="display:none; padding:8px 16px;font-size:1em;color:#666;">
                        fps: 0
                    </div>
                    <canvas id="ratioChart" width="500" height="200"></canvas>
                </div>
            </div>
            <div id="panel4" class="panel">
                <div style="flex: 0 0 200px; display: flex; flex-flow: column; width: 300px">
                    <h2>Forget the tinkering</h2>
                    <p>What are we? Macro Data Refiners? Let's automate the tinkering.</p>
                    <p>At this point, it's not much of a game, so here is a solution. Feel free to discard it and find your own.</p>
                    <p>Or even better, maybe you can find a better one?</p>
                </div>
                <div style="flex: 1 0 200px; display: flex; flex-flow: column;">
                    <label for="optimObjective"></label>
                    <textarea id="optimObjective" rows="12" cols="40">
//Example objective function for the optimizer
function objective(v) {
    let matrixWin = Array.from({ length: setSize + 1 }, () => Array(setSize + 1).fill(1));
    matrixWin[setSize] = Array(setSize + 1).fill(0);
    let matrixEnergy = Array.from({ length: setSize + 1 }, () => Array(setSize + 1).fill(0));

    for (let s = setSize - 1; s >= 0; s--) {
        for (let k = setSize - 1; k >= 0; k--) {
            e0 = v[s * setSize + k];
            p0 = e0 / (e0 + 1)

            vx = matrixWin[s][k + 1] * p0
            vy = matrixWin[s + 1][k] * (1 - p0)
            matrixWin[s][k] = vx + vy;

            ex = matrixEnergy[s][k + 1] * p0
            ey = matrixEnergy[s + 1][k] * (1 - p0)
            matrixEnergy[s][k] = e0 - 1 + ex + ey;
        }
    }
    return 1000 * matrixEnergy[0][0] * matrixEnergy[0][0] - matrixWin[0][0]
}
</textarea>
                    <button id="optimApply">Apply</button>
                    <button id="optimPause">Pause</button>
                </div>
                <div style="flex: 0 0 200px; padding: 20px">
                    <label for="optimizerSolution">Optimizer output :</label>
                    <pre id="optimizerSolution" style="background:#f8f8f8; border-radius:6px;">
[
 [
  1,
  1,
  1
 ],
 [
  1,
  1,
  1
 ],
 [
  1,
  1,
  1
 ]
]
</pre>
                </div>
                <div id="optimizerChartDiv" style="flex: 1 1 80%; background:#fff; max-height:400px">
                    <canvas id="optimizerCanvas" width="400" height="200"></canvas>
                </div>
            </div>

        </div>
    </div>
    <script>


        const buttons = [
            document.getElementById('btn0'),
            document.getElementById('btn1'),
            document.getElementById('btn2'),
            document.getElementById('btn3'),
            document.getElementById('btn4')
        ];
        const panels = [
            document.getElementById('panel0'),
            document.getElementById('panel1'),
            document.getElementById('panel2'),
            document.getElementById('panel3'),
            document.getElementById('panel4')
        ];
        const render = [
            null,
            manualRender,
            automationRender,
            chartRender,
            optimizerRender
        ];
        const hide = [
            null,
            null,
            autoHide,
            chartHide,
            optimHide
        ];
        buttons.forEach((btn, idx) => {
            btn.onclick = function () {
                buttons.forEach(b => b.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));
                hide.forEach(h => h && h());
                btn.classList.add('active');
                panels[idx].classList.add('active');
                if (render[idx]) {
                    render[idx]();
                }
            };
        });
    </script>
</body>
</html>

